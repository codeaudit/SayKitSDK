<!DOCTYPE html>
<html>

  <head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<title>SayKit Tour - Command Recognition: Part 2</title>
	<meta name="description" content="The conversational UI framework for voice enabled applications on iOS.
">

	<!-- Jekyll defaults -->
	<link rel="stylesheet" href="/css/main.css">
	<link rel="canonical" href="http://developer.conversantlabs.com/tour/command-recognition-pt2/">
	<!-- <link rel="alternate" type="application/rss+xml" title="SayKit SDK (Developer Preview)" href="http://developer.conversantlabs.com/feed.xml"> -->

	<!-- Bootstrap CDN -->
	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

	<!-- Optional theme -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">

	<!-- Latest compiled and minified JavaScript -->
	<script src="https://code.jquery.com/jquery-1.12.0.min.js"></script>

	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>

</head>


  <body>

    <header class="site-header">

  <nav class="navbar navbar-default">
    <div class="container">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <!-- <a class="navbar-brand" href="/">SayKit SDK (Developer Preview)</a> -->
        <a class="navbar-brand" href="/">SayKit SDK</a>
      </div>
      <div id="navbar" class="collapse navbar-collapse">
        <ul class="nav navbar-nav">
          <li><a href="/quick-start/">Quick Start</a></li>
          <li><a href="/tour/">Tour</a></li>
          <li><a href="/tutorial/">Tutorial</a></li>
          <li><a href="/documentation/">API Documentation</a></li>
          <!-- <li><a href="/Developer Guides/">Developer Guides</a></li> -->
          <li><a href="/roadmap/">Roadmap</a></li>
        </ul>
      </div><!--/.nav-collapse -->
    </div>
  </nav>

</header>


    <div class="container">
    	<div class="col-md-9">
      <h1>Command Recognition: Part 2</h1>

<h2>Extending Command Recognizers</h2>

<p>SayKit doesn&#39;t restrict you to its built-in library of recognizers. Standard recognizers can be extended to handle broader speech patterns and you can even create your own recognizers to handle custom commands.</p>

<p>Recognizer instances can be modified by adding <strong>Text Matchers</strong> to them. In essence, a text matcher is a simple agent that processes a string of text and decides how likely it is to match the relevant command. A few types of built-in text matchers exist, most notably the <code>SAYPatternCommandMatcher</code>, which uses a set of pattern templates to match user speech. We&#39;ll use one in a moment below.</p>

<p>As a quick example let&#39;s say we&#39;re building a Pokémon-themed email app (as you do), and we want to add a recipient to a message by recognizing the following command: &quot;I choose you, John Smith!&quot;. SayKit already provides the <code>SAYSelectCommandRecognizer</code>, which recognizes when the user wants to make a selection, but it wasn&#39;t necessarily built with Pokémon trainers in mind. So what can we do?</p>
<div class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="c1">// Swift, using a closure-style callback</span>

<span class="c1">// create the recognizer with an action block</span>
<span class="k">let</span> <span class="nv">selectRecognizer</span> <span class="o">=</span> <span class="kt">SAYSelectCommandRecognizer</span><span class="p">()</span> <span class="p">{</span> <span class="n">command</span> <span class="k">in</span>
    <span class="k">if</span> <span class="k">let</span> <span class="nv">name</span> <span class="o">=</span> <span class="n">command</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s">"name"</span><span class="p">]</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// add our special pattern, note the "name" parameter</span>
<span class="k">let</span> <span class="nv">pattern</span> <span class="o">=</span> <span class="s">"i choose you @name"</span>
<span class="n">selectRecognizer</span><span class="o">.</span><span class="nf">addTextMatcher</span><span class="p">(</span><span class="kt">SAYPatternCommandMatcher</span><span class="p">(</span><span class="nv">pattern</span><span class="p">:</span> <span class="n">pattern</span><span class="p">))</span>
</code></pre></div><div class="highlight"><pre><code class="language-objc" data-lang="objc"><span class="c1">// Objective-C, using a target/action-style callback
</span>
<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">addRecipent</span><span class="p">:(</span><span class="n">SAYCommand</span> <span class="o">*</span><span class="n">command</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">NSString</span> <span class="o">*</span><span class="n">name</span> <span class="o">=</span> <span class="n">command</span><span class="p">.</span><span class="n">parameters</span><span class="p">[</span><span class="s">@"name"</span><span class="p">];</span>
    <span class="cm">/* ... */</span>
<span class="p">}</span>

<span class="p">...</span>

    <span class="c1">// create the recognizer with an target/action selector
</span>    <span class="n">SAYCommandRecognizer</span> <span class="o">*</span><span class="n">selectRecognizer</span><span class="p">;</span>
    <span class="n">selectRecognizer</span> <span class="o">=</span> <span class="p">[[</span><span class="n">SAYSelectCommandRecognizer</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">initWithResponseTarget</span><span class="p">:</span><span class="n">self</span> 
                                                                           <span class="nf">action</span><span class="p">:</span><span class="k">@selector</span><span class="p">(</span><span class="nf">addRecipient</span><span class="p">:)]</span>

    <span class="c1">// add our special pattern, note the "name" parameter
</span>    <span class="n">NSString</span> <span class="o">*</span><span class="n">pattern</span> <span class="o">=</span> <span class="s">@"i choose you @name"</span><span class="p">;</span>
    <span class="n">selectRecognizer</span><span class="p">.</span><span class="n">addTextMatcher</span><span class="p">([</span><span class="n">SAYPatternCommandMatcher</span> <span class="nf">matcherWithPattern</span><span class="p">:</span><span class="n">pattern</span><span class="p">]);</span>
</code></pre></div>
<p>Done! Assuming you have a bunch of Pokémon in your address book, you&#39;ve now got the very best email client.</p>

<h2>Custom Commands</h2>

<p>It&#39;s fairly likely that you&#39;ll need to employ recognizers for commands that SayKit does not provide. For these cases, the <code>SAYCustomCommandRecognizer</code> is available. For instance, here&#39;s a quick recognizer that attempts to recognize greetings, using the custom command type &quot;Greeting&quot;:</p>
<div class="highlight"><pre><code class="language-Swift" data-lang="Swift">// Swift
let greetingsRecognizer = SAYCustomCommandRecognizer(customType: "Greeting") { cmd in /* ... */ }
let patterns = ["hello", "hey", "what's up"]
greetingsRecognizer.addTextMatcher(SAYPatternCommandMatcher(patterns:patterns))
</code></pre></div><div class="highlight"><pre><code class="language-objc" data-lang="objc"><span class="c1">// Objective-C
</span><span class="n">SAYCustomCommandRecognizer</span> <span class="o">*</span><span class="n">greetingsRecognizer</span> <span class="o">=</span> 
    <span class="p">[[</span><span class="n">SAYCustomCommandRecognizer</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">initWithCustomType</span><span class="p">:</span><span class="s">@"Greeting"</span>
                                                <span class="nf">actionBlock</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">SAYCommand</span> <span class="o">*</span> <span class="n">_Nonnull</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">}];</span>
<span class="n">NSArray</span> <span class="o">*</span><span class="n">patterns</span> <span class="o">=</span> <span class="p">@[</span><span class="s">@"hello"</span><span class="p">,</span> <span class="s">@"hey"</span><span class="p">,</span> <span class="s">@"what's up"</span><span class="p">,</span> <span class="s">"greetings"</span><span class="p">];</span>
<span class="p">[</span><span class="n">greetingsRecognizer</span> <span class="nf">addTextMatcher</span><span class="p">:[</span><span class="n">SAYPatternCommandMatcher</span> <span class="nf">matcherWithPatterns</span><span class="p">:</span><span class="n">patterns</span><span class="p">]];</span>
</code></pre></div>
<p>In the near future, we&#39;ll be previewing more robust custom command recognition tools, including the intregration of third-party intent recognition services.</p>

<p>This just scratches the surface of customizing command recognizers. To learn more, check out our developer guide on the topic (coming soon!).</p>

<h2>Command Dialogues</h2>

<p>The app listens for a user command via the same mechanism it uses for listening to all user speech: as part of a <code>SAYVoiceRequest</code> session. Specifically, it uses a <code>SAYVerbalCommandRequest</code>.</p>

<p>Just like <a href="/tour/voice-requests/#voice-request-flow">any other voice request</a>, a <code>SAYVerbalCommandRequest</code> has a <em>responding</em> stage. And just like any other voice request, the response can include a follow-up request, which causes the app to ask the user a new question. This means the app can jump straight into a conversation with the user directly in response to a command. To pull this off, simply return the followup request from your recognizer instance&#39;s action method/block.</p>

<p>We&#39;ll illustrate with an example of a &quot;Help&quot; command. If we&#39;re able to help, the app needs to know what the user needs help with. Let&#39;s find out by asking directly. Followup responses to the rescue!</p>
<div class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="c1">// Swift, using a closure-style callback</span>

<span class="c1">// Of course, we're here to help!</span>
<span class="k">let</span> <span class="nv">helpIsAvailable</span> <span class="o">=</span> <span class="kc">true</span>

<span class="c1">// Note the action block's signature: we're returning a response now</span>
<span class="n">commandRegistry</span><span class="o">.</span><span class="nf">addCommandRecognizer</span><span class="p">(</span><span class="kt">SAYHelpCommandRecognizer</span> <span class="p">{</span> <span class="n">command</span> <span class="o">-&gt;</span> <span class="kt">SAYVoiceRequestResponse</span> <span class="k">in</span>
    <span class="k">if</span> <span class="n">helpIsAvailable</span> <span class="p">{</span>
        <span class="c1">// respond with a new voice request</span>
        <span class="k">let</span> <span class="nv">followupRequest</span> <span class="o">=</span> <span class="kt">SAYStringRequest</span><span class="p">(</span><span class="nv">promptText</span><span class="p">:</span> <span class="s">"What would you like help with?"</span><span class="p">,</span> <span class="nv">action</span><span class="p">:</span> <span class="p">{</span><span class="cm">/* ...provide help... */</span><span class="p">}</span>
        <span class="k">return</span> <span class="kt">SAYVoiceRequestResponse</span><span class="p">(</span><span class="nv">followupRequest</span><span class="p">:</span> <span class="n">followupRequest</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// no need to follow up, just terminate the request and run the given action block</span>
        <span class="k">return</span> <span class="kt">SAYVoiceRequestResponse</span><span class="o">.</span><span class="nf">terminalResponseWithAction</span><span class="p">({</span><span class="cm">/* ... */</span><span class="p">})</span>
    <span class="p">}</span>
<span class="p">})</span>
</code></pre></div><div class="highlight"><pre><code class="language-objc" data-lang="objc"><span class="c1">// Objective-C, using a target/action-style callback
</span>
<span class="c1">// Note the signature: action selectors can have a (SAYVoiceCommandResponse *) return type
</span><span class="k">-</span> <span class="p">(</span><span class="n">SAYVoiceRequestResponse</span> <span class="o">*</span><span class="p">)</span><span class="nf">provideHelp</span><span class="p">:(</span><span class="n">SAYCommand</span> <span class="o">*</span><span class="n">command</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">helpIsAvailable</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// respond with a new voice request
</span>        <span class="n">SAYStringRequest</span> <span class="o">*</span><span class="n">request</span> <span class="o">=</span> <span class="p">[[</span><span class="n">SAYStringRequest</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">initWithPromptText</span><span class="p">:</span><span class="s">@"What would you like help with?"</span><span class="p">,</span>
                                                                          <span class="nf">action</span><span class="p">:</span><span class="cm">/* ...provide help... */</span><span class="p">];</span> 
        <span class="k">return</span> <span class="p">[</span><span class="n">SAYVoiceRequestResponse</span> <span class="nf">responseWithFollowupRequest</span><span class="p">:</span><span class="n">request</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// no need to follow up, just terminate the request and run the given action block
</span>        <span class="k">return</span> <span class="p">[</span><span class="n">SAYVoiceRequestResponse</span> <span class="nf">terminalResponseWithAction</span><span class="p">:</span><span class="o">^</span><span class="p">{</span><span class="cm">/* ... */</span><span class="p">}];</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="p">...</span>
    <span class="n">helpRecognizer</span> <span class="o">=</span> <span class="p">[[</span><span class="n">SAYHelpCommandRecognizer</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">initWithResponseTarget</span><span class="p">:</span><span class="n">self</span> 
                                                                           <span class="nf">action</span><span class="p">:</span><span class="k">@selector</span><span class="p">(</span><span class="nf">provideHelp</span><span class="p">:)];</span>
<span class="p">...</span>
</code></pre></div>
<p>Sure, it&#39;s a bit more involved, but your app just got a lot more responsive with those few new lines of code.</p>

<hr>

<p>Now let&#39;s take a deep breath before we switch contexts completely. Up until now, the app only speaks question prompts to the user. How do break from that mold and let the app speak freely?</p>

<p><a href="/tour/audio-output/">Next - Audio Output &gt;&gt;</a></p>

      </div>
    </div>

    <footer class="site-footer">

  <div class="container">

    <!-- <h2>SayKit SDK (Developer Preview)</h2> -->

      <div class="col-md-4">
        <ul class="contact-list">
          <li>SayKit SDK (Developer Preview)</li>
          <li><a href="mailto:engineering@conversantlabs.com">engineering@conversantlabs.com</a></li>
        </ul>
      </div>

      <div class="col-md-4">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/ConversantLabs"><span class="icon icon--github"><svg viewBox="0 0 16 16"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">ConversantLabs</span></a>

          </li>
          

          
          <li>
            <a href="https://twitter.com/ConversantLabs"><span class="icon icon--twitter"><svg viewBox="0 0 16 16"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
</span><span class="username">ConversantLabs</span></a>

          </li>
          
        </ul>
      </div>

      <div class="col-md-4">
        <p>The conversational UI framework for voice enabled applications on iOS.
</p>
      </div>
    
  </div>

</footer>


  </body>

</html>
